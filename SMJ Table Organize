
library(rempsyc)

library(foreign)
library(pscl)
require(LaF)
require(ETLUtils)
library(xtable)
require(biglm)
library(psych)
library(xtable)
library(gt)
library(tibble)
# clearing with p value in a separate line, no stars for any journal

library(xtable)
library(gt)
library(tibble)

cleardata<-function(input){
names<-rownames(input)
final<-matrix("",nrow=nrow(input)*3,ncol=2)
j=1
for(i in 1:nrow(input)){
coe<-format(round(as.numeric(input[i,1]),digits=3),nsmall=3)
st<-paste("(",format(round(as.numeric(as.matrix(input[i,3])),digits=3),nsmall=3),")",sep="")
pvalue<-paste("[",format(round(as.numeric(as.matrix(input[i,5])),digits=3),nsmall=3),"]",sep="")

final[j,1]<-paste(names[i],"1")
final[j+1,1]<-paste(names[i],"2")
final[j+2,1]<-paste(names[i],"3")
final[j,2]<-coe
final[j+1,2]<-st
final[j+2,2]<-pvalue
j<-j+3
}
return(final)
}



createtable<-function(island){


islands_tbl <- 
tibble(
island
)

gt_tbl <- gt(data = islands_tbl,
rowname_col = NULL,
getOption("gt.row_group.sep", ""))%>%tab_style(
style = list(
cell_borders(
sides = c("top", "bottom"),
color = "white",
weight = px(1)
),
cell_borders(
sides = c("left", "right"),
color = "white",
weight = px(1)
)),
locations = cells_body(
columns = everything(),
rows = everything()
)
)


return(gt_tbl) 

}

library(survival)

# Model 1
results <- coxph(Surv(monthpast, firstdeal) ~ 

investindustry+
age+
early_stage+
protestnumber+
averagescale+
totalpop+
gdpaverage+
diversity

, data = panel)
summary(results)

finalresults <- summary(results)
names(finalresults)
modelformat<-data.frame(rbind(
                            cleardata(finalresults $coefficients),
                             c("Obs.",finalresults$n),
                       c("Log lik.", round(finalresults$loglik[2],digit=3))
                                ) )
printmodel <- modelformat
printmodel$label<-NULL


# Model 2
results <- coxph(Surv(monthpast, firstdeal) ~ 

investindustry+
age+
early_stage+
protestnumber+
averagescale+
totalpop+
gdpaverage+
diversity+
scope 

, data = panel)
summary(results)

finalresults <- summary(results)

modelformat<-data.frame(rbind(
                            cleardata(finalresults$coefficients),
                             c("Obs.",finalresults$n),
                                c("Log lik.", round(finalresults$loglik[2],digit=3))
                                ) )
printmodel = merge(printmodel, modelformat, all= TRUE,by.x= 'X1', by.y= "X1" )
printmodel$label<-NULL

# Model 3
results <- coxph(Surv(monthpast, firstdeal) ~ 
scope +
rankofsocialfocus+

scope:rankofsocialfocus+


investindustry+
age+
early_stage+
protestnumber+
averagescale+
totalpop+
gdpaverage+
diversity+

scope 

, data = panel)
summary(results)

finalresults <- summary(results)

modelformat<-data.frame(rbind(
                            cleardata(finalresults$coefficients),
                             c("Obs.",finalresults$n),
                              c("Log lik.", round(finalresults$loglik[2],digit=3))
                                ) )
printmodel = merge(printmodel, modelformat, all= TRUE,by.x= 'X1', by.y= "X1" )
printmodel$label<-NULL

# Model 4
results <- coxph(Surv(monthpast, firstdeal) ~ 

scope +
otherinvestors+
scope:otherinvestors+

investindustry+
age+
early_stage+
protestnumber+
averagescale+
totalpop+
gdpaverage+
diversity

, data = panel)
summary(results)

finalresults <- summary(results)

modelformat<-data.frame(rbind(
                            cleardata(finalresults $coefficients),
                             c("Obs.",finalresults$n),
                                  c("Log lik.", round(finalresults$loglik[2],digit=3))
                                ) )
printmodel= merge(printmodel, modelformat,  all= TRUE ,by.x= 'X1', by.y= "X1" )
printmodel$label<-NULL

# Full model
results <- coxph(Surv(monthpast, firstdeal) ~ 
scope +
rankofsocialfocus+
otherinvestors+
scope:rankofsocialfocus+
scope:otherinvestors+

investindustry+
age+
early_stage+
protestnumber+
averagescale+
totalpop+
gdpaverage+
diversity

, data = panel)
summary(results)

finalresults <- summary(results)

modelformat<-data.frame(rbind(
                            cleardata(finalresults$coefficients),
                             c("Obs.",finalresults$n),
                     c("Log lik.", round(finalresults$loglik[2],digit=3))
                                ) )
printmodel = merge(printmodel, modelformat, all= TRUE, by.x= 'X1', by.y= "X1" )
printmodel$label<-NULL

Final = printmodel

Final[is.na(Final)] <- ""
prefix <- "Model"
suffix<-seq(1,(ncol(Final)-1))
colnames(Final)<-c("label",paste(prefix,suffix))


write.table(Final$label,
            file="/Users/katewang/Library/CloudStorage/Dropbox/WangjuekateDropbox/Jiayi_Protest_Investment/TableFigure/variablenames_adj.csv",
            sep=",",
            row.names=FALSE)
    
varname<-read.table("/Users/katewang/Library/CloudStorage/Dropbox/WangjuekateDropbox/Jiayi_Protest_Investment/TableFigure/maintable.csv",sep=",",header=TRUE)

printmodel<-merge(varname, Final,by.x = "x", by.y = "label",  all.x=TRUE, sort = F)   

printmodel$label<-NULL
printmodel$x<-NULL

test = xtable(printmodel)
print(test,
      type = "latex",
      file = "/Users/katewang/Library/CloudStorage/Dropbox/WangjuekateDropbox/Jiayi_Protest_Investment/TableFigure/table_only.tex",  # This creates a file with just the table code
      include.rownames = FALSE,
      latex.environments = "center",
      sanitize.text.function = function(x) x)



